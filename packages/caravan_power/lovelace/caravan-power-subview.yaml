title: Power
path: caravan-Power
icon: mdi:power
type: sections
subview: true
max_columns: 1
dense_section_placement: true
theme: Mushroom Square
sections:
  - type: grid
    cards:
      - type: custom:button-card
        name: Power
        icon: mdi:power-plug-battery
        show_state: true
        show_icon: true
        show_name: true
        entity: sensor.caravan_battery_voltage
        tap_action:
          action: navigate
          navigation_path: /lovelace/caravan-Power
        hold_action:
          action: more-info
          entity: sensor.caravan_battery_voltage
        state_display: |
          [[[
            const v = parseFloat(states['sensor.caravan_battery_voltage']?.state);
            const p = parseFloat(states['sensor.caravan_battery_power']?.state);
            const soc = parseFloat(states['sensor.caravan_battery_soc']?.state);

            const src = (states['sensor.caravan_power_source']?.state || '—');
            const ui = (states['sensor.caravan_battery_ui_status']?.state || '—');

            const vv = Number.isFinite(v) ? `${v.toFixed(2)} V` : '— V';
            const pp = Number.isFinite(p) ? `${p.toFixed(0)} W` : '— W';
            const ss = Number.isFinite(soc) ? `SoC ${soc.toFixed(0)}%` : 'SoC —%';

            return `${ss} • ${vv} • ${pp} • ${src} • ${ui}`;
          ]]]
        styles:
          card:
            - border-radius: 18px
            - padding: 14px 14px 22px 14px
            - overflow: hidden
          grid:
            - grid-template-areas: "\"i n\" \"i s\" \"bar bar\""
            - grid-template-columns: 80px 1fr
            - grid-template-rows: min-content min-content 14px
            - column-gap: 10px
            - row-gap: 6px
          name:
            - font-size: 18px
            - font-weight: 800
            - line-height: 1.1
            - white-space: normal
            - overflow-wrap: anywhere
          state:
            - font-size: 16px
            - font-weight: 800
            - line-height: 1.15
            - white-space: normal
            - overflow-wrap: anywhere
            - word-break: break-word
          icon:
            - width: 64px
        custom_fields:
          bar: |
            [[[
              const soc = parseFloat(states['sensor.caravan_battery_soc']?.state);
              const clamped = Number.isFinite(soc) ? Math.max(0, Math.min(100, soc)) : 0;

              const col = (states['sensor.caravan_battery_ui_status']?.attributes?.color || 'blue');
              let rgb = '0,140,255';
              if (col === 'green') rgb = '40,200,120';
              else if (col === 'orange') rgb = '255,150,40';
              else if (col === 'red') rgb = '255,40,40';
              else if (col === 'grey') rgb = '120,120,120';

              return `
                <div style="
                  height:10px;border-radius:10px;
                  background: rgba(31,41,55,0.12);
                  position:relative; overflow:hidden;">
                  <div style="
                    height:10px; width:${clamped}%;
                    background: rgba(${rgb},0.95);
                    box-shadow: 0 0 12px rgba(${rgb},0.55);
                    border-radius:10px;">
                  </div>
                </div>
              `;
            ]]]
        custom_fields_style:
          bar:
            - grid-area: bar
